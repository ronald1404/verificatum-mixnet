#!/bin/bash

CORRECTNESS=noninteractive
PRG=SHA-256
PGROUP=$(vog -gen ModPGroup -fixed 1024)

echo "Creating Session..."

vmni -prot \
-sid 'MyDemo' \
-name 'Swedish Election' \
-nopart 1 \
-thres 1 \
-corr $CORRECTNESS \
-prg $PRG \
-pgroup "$PGROUP"


echo "Creating Mix Servers"
vmni -party -name "MixServer 1" stub.xml privInfo.xml protInfo.xml

echo "Generating public key"
vmn -keygen privInfo.xml protInfo.xml publicKey

echo "generating demo ciphs"
vmnd -ciphs publicKey 10 ciphertexts

echo "Mixing"
vmn -mix privInfo.xml protInfo.xml ciphertexts plaintexts

echo "converting bin files to json files"
vmnc -pkey -outi json protInfo.xml publicKey publicKeyJson
vmnc -ciphs -outi json protInfo.xml ciphertexts ciphertextsJson
vmnc -plain -outi json protInfo.xml plaintexts plaintextsJson

vmnc -pkey -outi native protInfo.xml publicKey publicKeyNative
vmnc -ciphs -outi native protInfo.xml ciphertexts ciphertextsNative
vmnc -plain -outi native protInfo.xml plaintexts plaintextsNative
